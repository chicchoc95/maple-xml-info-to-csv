name: XML to CSV Batch Converter

on:
  push:
    paths:
      - "*.xml"
      - "xmls/*.xml"
      - "xml_info_to_csv_batch.py"
      - ".github/workflows/xml_to_csv.yml"
  workflow_dispatch:

# 이게 있어야 Actions가 레포에 commit/push 할 수 있음
permissions:
  contents: write

jobs:
  convert:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          token: ${{ secrets.GITHUB_TOKEN }}

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.10"

      - name: Run XML to CSV batch script
        run: |
          python xml_info_to_csv_batch.py

      - name: Move CSV files into output folder
        run: |
          mkdir -p output-csv
          mv ./*.csv output-csv/ || echo "No CSV files to move"

      - name: Commit and push CSV files
        run: |
          git config user.name "github-actions[bot]"
          git config user.email "41898282+github-actions[bot]@users.noreply.github.com"

          # 변경된 CSV가 없으면 커밋 안 함
          git add output-csv/*.csv || echo "Nothing to add"

          if git diff --cached --quiet; then
            echo "No changes to commit"
          else
            git commit -m "Auto-generate CSV files from XML [skip ci]"
            git push
          fi
